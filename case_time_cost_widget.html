<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Case Time & Labor Cost Widget</title>
  <style>
    :root{
      --bg: #0b1723;
      --card: #111c28;
      --accent1: #00c853;
      --accent2: #00e676;
      --muted: #93a1b1;
      --text: #e8eef3;
      --border: #1f2a36;
      --shadow: 0 20px 40px rgba(0,0,0,.25);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(135deg, #061018, #0c2234 40%, #0d2b3e);
      color: var(--text);
      padding: 24px;
      display:flex; align-items:center; justify-content:center;
    }
    .app{
      width:min(1080px, 96vw);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header{
      padding:20px 24px;
      background: radial-gradient(1200px 200px at -10% -40%, rgba(0,200,83,.25), transparent 50%),
                  radial-gradient(900px 160px at 120% -60%, rgba(0,230,118,.20), transparent 60%);
      border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      flex-wrap:wrap;
    }
    h1{font-size:20px; margin:0}
    .buttons{display:flex; gap:8px; flex-wrap:wrap}
    button, .btn{
      appearance:none; border:1px solid var(--border); background:#0b1520; color:var(--text);
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    button:hover{border-color:#294155}
    .btn-accent{
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color:#032010; border:none;
    }
    main{display:grid; grid-template-columns: 1.1fr 1fr; gap:0; min-height:420px}
    @media (max-width: 900px){ main{grid-template-columns: 1fr; } }
    .panel{
      padding:22px; border-right:1px solid var(--border);
    }
    .panel:last-child{border-right:none}
    .group{margin-bottom:18px}
    .group h2{font-size:14px; text-transform:uppercase; letter-spacing:.08em; color:#cfe6d9; margin:0 0 10px}
    .field{
      display:grid; grid-template-columns: 1fr 140px; gap:12px; align-items:center;
      padding:10px 12px; border:1px solid var(--border); border-radius:12px; margin:10px 0; background:rgba(255,255,255,.02)
    }
    .field label{font-weight:600; color:#d7e3ea}
    .field input{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #294155; background:#081420; color:var(--text);
      font-weight:600;
    }
    .hint{font-size:12px; color:var(--muted); margin-top:6px}
    .results{
      display:grid; gap:12px; padding:22px;
    }
    .kpi{
      border:1px solid var(--border); border-radius:14px; padding:16px 18px; background:rgba(255,255,255,.02);
      display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center;
    }
    .kpi .label{color:#cfe6d9; font-weight:600}
    .kpi .value{font-size:22px; font-weight:800}
    .kpi small{color:var(--muted)}
    .two-col{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    @media (max-width: 560px){ .two-col{grid-template-columns:1fr} }
    .pill{
      font-size:12px; color:#05361f; font-weight:800; background:linear-gradient(90deg, var(--accent1), var(--accent2));
      padding:4px 10px; border-radius:999px;
    }
    footer{border-top:1px solid var(--border); padding:14px 22px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; color:#b7c6d3}
    code{background:#0b1723; padding:2px 6px; border-radius:6px; border:1px solid var(--border)}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Case Time & Labor Cost Widget">
    <header>
      <h1>Case Time & Labor Cost <span class="pill">Live</span></h1>
      <div class="buttons">
        <button id="shareBtn" title="Copy a link that preserves your current inputs">Copy link with values</button>
        <button id="resetBtn">Reset</button>
        <a class="btn btn-accent" id="downloadCSV" href="#" download="calculator_snapshot.csv">Export results (CSV)</a>
      </div>
    </header>
    <main>
      <section class="panel" aria-label="Inputs">
        <div class="group">
          <h2>Inputs</h2>
          <div class="field">
            <label for="cases">Cases per day</label>
            <input id="cases" type="number" inputmode="numeric" step="1" min="0" value="600" />
          </div>
          <div class="field">
            <label for="t_dl">Time per case: Downloading</label>
            <input id="t_dl" type="number" step="0.01" min="0" value="1.80" />
            <div class="hint">minutes per case</div>
          </div>
          <div class="field">
            <label for="t_lms">Time per case: LMS entry</label>
            <input id="t_lms" type="number" step="0.01" min="0" value="2.40" />
            <div class="hint">minutes per case</div>
          </div>
          <div class="field">
            <label for="staff">Number of staff</label>
            <input id="staff" type="number" step="1" min="0" value="6" />
          </div>
          <div class="field">
            <label for="wage">Hourly wage</label>
            <input id="wage" type="number" step="0.01" min="0" value="30.00" />
            <div class="hint">A$ per hour (AUD)</div>
          </div>
          <div class="hint">Formulas: total minutes = <code>cases × minutes per case</code>; hours = <code>minutes ÷ 60</code>; per‑person = <code>team ÷ staff</code>; labor cost = <code>hours × wage</code>.</div>
        </div>
      </section>
      <aside class="results" aria-live="polite" aria-label="Results">
        <div class="group">
          <h2>Per‑person (daily)</h2>
          <div class="two-col">
            <div class="kpi"><div class="label">Downloading – hours</div><div class="value" id="pp_dl">0.00 hrs</div></div>
            <div class="kpi"><div class="label">LMS Entry – hours</div><div class="value" id="pp_lms">0.00 hrs</div></div>
          </div>
          <div class="kpi">
            <div>
              <div class="label">Combined – hours</div>
              <small>(downloading + LMS entry)</small>
            </div>
            <div class="value" id="pp_comb">0.00 hrs</div>
          </div>
          <div class="kpi">
            <div class="label">Labor cost – per person</div>
            <div class="value" id="pp_cost">A$0.00</div>
          </div>
        </div>

        <div class="group">
          <h2>Team totals (daily)</h2>
          <div class="two-col">
            <div class="kpi"><div class="label">Downloading – total hours</div><div class="value" id="tm_dl">0.00 hrs</div></div>
            <div class="kpi"><div class="label">LMS Entry – total hours</div><div class="value" id="tm_lms">0.00 hrs</div></div>
          </div>
          <div class="kpi">
            <div>
              <div class="label">Combined – total hours</div>
              <small>(team)</small>
            </div>
            <div class="value" id="tm_comb">0.00 hrs</div>
          </div>
          <div class="kpi">
            <div class="label">Labor cost – team</div>
            <div class="value" id="tm_cost">A$0.00</div>
          </div>
        </div>
      </aside>
    </main>
    <footer>
      <div>Recalc: <code id="ts">—</code></div>
      <div>Tip: values persist on this device (localStorage). Use “Copy link with values” to share a prefilled URL.</div>
    </footer>
  </div>

  <script>
    (function(){
      const $ = id => document.getElementById(id);
      const fields = ["cases","t_dl","t_lms","staff","wage"].map($);
      const fmtHour = (h)=> (isFinite(h)? (h.toFixed(2) + " hrs") : "0.00 hrs");
      const currency = new Intl.NumberFormat('en-AU', {style:'currency', currency:'AUD'});
      const nowStr = ()=> new Date().toLocaleString();

      function getVals(){
        const v = {
          cases: +$("cases").value || 0,
          t_dl: +$("t_dl").value || 0,
          t_lms: +$("t_lms").value || 0,
          staff: +$("staff").value || 0,
          wage: +$("wage").value || 0,
        };
        return v;
      }

      function calc(){
        const v = getVals();
        // Minutes (team)
        const m_dl = v.cases * v.t_dl;
        const m_lms = v.cases * v.t_lms;

        // Hours (team)
        const h_dl_team = m_dl / 60;
        const h_lms_team = m_lms / 60;
        const h_comb_team = h_dl_team + h_lms_team;

        // Hours (per person)
        const h_dl_pp = v.staff > 0 ? h_dl_team / v.staff : 0;
        const h_lms_pp = v.staff > 0 ? h_lms_team / v.staff : 0;
        const h_comb_pp = h_dl_pp + h_lms_pp;

        // Costs
        const cost_pp = h_comb_pp * v.wage;
        const cost_team = h_comb_team * v.wage;

        // Update UI
        $("pp_dl").textContent = fmtHour(h_dl_pp);
        $("pp_lms").textContent = fmtHour(h_lms_pp);
        $("pp_comb").textContent = fmtHour(h_comb_pp);
        $("pp_cost").textContent = currency.format(isFinite(cost_pp)? cost_pp : 0);

        $("tm_dl").textContent = fmtHour(h_dl_team);
        $("tm_lms").textContent = fmtHour(h_lms_team);
        $("tm_comb").textContent = fmtHour(h_comb_team);
        $("tm_cost").textContent = currency.format(isFinite(cost_team)? cost_team : 0);

        $("ts").textContent = nowStr();
      }

      function save(){
        const v = getVals();
        localStorage.setItem("calcWidget", JSON.stringify(v));
      }
      function load(){
        // URL params have priority
        const params = new URLSearchParams(location.search);
        const saved = localStorage.getItem("calcWidget");
        let seed = saved ? JSON.parse(saved) : {};
        ["cases","t_dl","t_lms","staff","wage"].forEach(k => {
          if(params.has(k)){
            seed[k] = +params.get(k);
          }
        });
        // Apply to fields if we have something
        if(Object.keys(seed).length){
          if(seed.cases!=null) $("cases").value = seed.cases;
          if(seed.t_dl!=null) $("t_dl").value = seed.t_dl;
          if(seed.t_lms!=null) $("t_lms").value = seed.t_lms;
          if(seed.staff!=null) $("staff").value = seed.staff;
          if(seed.wage!=null) $("wage").value = seed.wage;
        }
      }

      function shareLink(){
        const v = getVals();
        const url = new URL(location.href);
        url.searchParams.set("cases", v.cases);
        url.searchParams.set("t_dl", v.t_dl);
        url.searchParams.set("t_lms", v.t_lms);
        url.searchParams.set("staff", v.staff);
        url.searchParams.set("wage", v.wage);
        navigator.clipboard.writeText(url.toString()).then(()=>{
          alert("Link copied! Paste into PowerPoint Web Viewer or a browser.");
        }, ()=>{
          prompt("Copy this link:", url.toString());
        });
      }

      function toCSV(){
        const v = getVals();
        const rows = [
          ["Metric","Value","Units"],
          ["Cases per day", v.cases, "count"],
          ["Time per case: Downloading", v.t_dl, "minutes per case"],
          ["Time per case: LMS Entry", v.t_lms, "minutes per case"],
          ["Number of staff", v.staff, "people"],
          ["Hourly wage", v.wage, "A$ per hour"],
          [],
          ["Results","",""],
        ];
        // inline calc
        const m_dl = v.cases * v.t_dl;
        const m_lms = v.cases * v.t_lms;
        const h_dl_team = m_dl / 60;
        const h_lms_team = m_lms / 60;
        const h_comb_team = h_dl_team + h_lms_team;
        const h_dl_pp = v.staff > 0 ? h_dl_team / v.staff : 0;
        const h_lms_pp = v.staff > 0 ? h_lms_team / v.staff : 0;
        const h_comb_pp = h_dl_pp + h_lms_pp;
        const cost_pp = h_comb_pp * v.wage;
        const cost_team = h_comb_team * v.wage;

        rows.push(["Per‑person – Downloading (hours)", h_dl_pp.toFixed(2), "hrs"]);
        rows.push(["Per‑person – LMS Entry (hours)", h_lms_pp.toFixed(2), "hrs"]);
        rows.push(["Per‑person – Combined (hours)", h_comb_pp.toFixed(2), "hrs"]);
        rows.push(["Per‑person – Labor cost", cost_pp.toFixed(2), "A$"]);
        rows.push(["Team – Downloading (hours)", h_dl_team.toFixed(2), "hrs"]);
        rows.push(["Team – LMS Entry (hours)", h_lms_team.toFixed(2), "hrs"]);
        rows.push(["Team – Combined (hours)", h_comb_team.toFixed(2), "hrs"]);
        rows.push(["Team – Labor cost", cost_team.toFixed(2), "A$"]);

        const csv = rows.map(r => r.map(x => `"${String(x).replaceAll('"','""')}"`).join(",")).join("\n");
        const blob = new Blob([csv], {type:"text/csv"});
        const url = URL.createObjectURL(blob);
        const a = document.getElementById("downloadCSV");
        a.href = url;
        setTimeout(()=> URL.revokeObjectURL(url), 5000);
      }

      // Bind
      fields.forEach(el=>{
        el.addEventListener("input", ()=>{ calc(); save(); toCSV(); });
        el.addEventListener("change", ()=>{ calc(); save(); toCSV(); });
      });
      document.getElementById("resetBtn").addEventListener("click", ()=>{
        localStorage.removeItem("calcWidget");
        ["cases","t_dl","t_lms","staff","wage"].forEach((id, i)=>{
          const defaults = [600,1.8,2.4,6,30.0];
          $(id).value = defaults[i];
        });
        calc(); save(); toCSV();
      });
      document.getElementById("shareBtn").addEventListener("click", shareLink);

      // Init
      load();
      calc();
      toCSV();
    })();
  </script>
</body>
</html>
